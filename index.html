<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hyper Stacks</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        .hidden {
            display: none !important;
        }
        .progress-bar {
            transition: width 0.5s ease;
        }
        /* Color scheme backgrounds */
        .bg-scheme-default { background-color: #0f172a; }
        .bg-scheme-default-card { background-color: #1e293b; }
        .bg-scheme-default-button { background-color: #334155; }
        .bg-scheme-default-button:hover { background-color: #475569; }
        .bg-scheme-default-input { background-color: #334155; color: white; }
        
        .bg-scheme-emerald { background-color: #064e3b; }
        .bg-scheme-emerald-card { background-color: #065f46; }
        .bg-scheme-emerald-button { background-color: #047857; }
        .bg-scheme-emerald-button:hover { background-color: #059669; }
        .bg-scheme-emerald-input { background-color: #047857; color: white; }
        
        .bg-scheme-blue { background-color: #1e3a8a; }
        .bg-scheme-blue-card { background-color: #1e40af; }
        .bg-scheme-blue-button { background-color: #1d4ed8; }
        .bg-scheme-blue-button:hover { background-color: #2563eb; }
        .bg-scheme-blue-input { background-color: #1d4ed8; color: white; }
        
        .bg-scheme-purple { background-color: #581c87; }
        .bg-scheme-purple-card { background-color: #6b21a8; }
        .bg-scheme-purple-button { background-color: #7e22ce; }
        .bg-scheme-purple-button:hover { background-color: #9333ea; }
        .bg-scheme-purple-input { background-color: #7e22ce; color: white; }
        
        .bg-scheme-amber { background-color: #d97706; }
        .bg-scheme-amber-card { background-color: #f59e0b; }
        .bg-scheme-amber-button { background-color: #fbbf24; }
        .bg-scheme-amber-button:hover { background-color: #fcd34d; }
        .bg-scheme-amber-input { background-color: #fcd34d; color: #1e293b; }
        
        .bg-scheme-red { background-color: #7f1d1d; }
        .bg-scheme-red-card { background-color: #991b1b; }
        .bg-scheme-red-button { background-color: #b91c1c; }
        .bg-scheme-red-button:hover { background-color: #dc2626; }
        .bg-scheme-red-input { background-color: #b91c1c; color: white; }
        
        .bg-scheme-pink { background-color: #831843; }
        .bg-scheme-pink-card { background-color: #9f1239; }
        .bg-scheme-pink-button { background-color: #be185d; }
        .bg-scheme-pink-button:hover { background-color: #db2777; }
        .bg-scheme-pink-input { background-color: #be185d; color: white; }
        
        .bg-scheme-indigo { background-color: #312e81; }
        .bg-scheme-indigo-card { background-color: #3730a3; }
        .bg-scheme-indigo-button { background-color: #4338ca; }
        .bg-scheme-indigo-button:hover { background-color: #4f46e5; }
        .bg-scheme-indigo-input { background-color: #4338ca; color: white; }
        
        .bg-scheme-teal { background-color: #134e4a; }
        .bg-scheme-teal-card { background-color: #115e59; }
        .bg-scheme-teal-button { background-color: #0f766e; }
        .bg-scheme-teal-button:hover { background-color: #0d9488; }
        .bg-scheme-teal-input { background-color: #0f766e; color: white; }
        
        .bg-scheme-orange { background-color: #ea580c; }
        .bg-scheme-orange-card { background-color: #f97316; }
        .bg-scheme-orange-button { background-color: #fb923c; }
        .bg-scheme-orange-button:hover { background-color: #fdba74; }
        .bg-scheme-orange-input { background-color: #fdba74; color: #1e293b; }
        
        .bg-scheme-cyan { background-color: #164e63; }
        .bg-scheme-cyan-card { background-color: #155e75; }
        .bg-scheme-cyan-button { background-color: #0e7490; }
        .bg-scheme-cyan-button:hover { background-color: #0891b2; }
        .bg-scheme-cyan-input { background-color: #0e7490; color: white; }
        
        .bg-scheme-lime { background-color: #84cc16; }
        .bg-scheme-lime-card { background-color: #a3e635; }
        .bg-scheme-lime-button { background-color: #bef264; }
        .bg-scheme-lime-button:hover { background-color: #d9f99d; }
        .bg-scheme-lime-input { background-color: #d9f99d; color: #1e293b; }
        
        .bg-scheme-rose { background-color: #881337; }
        .bg-scheme-rose-card { background-color: #9f1239; }
        .bg-scheme-rose-button { background-color: #be123c; }
        .bg-scheme-rose-button:hover { background-color: #e11d48; }
        .bg-scheme-rose-input { background-color: #be123c; color: white; }

        /* Progress bar colors */
        .progress-emerald { background-color: #10b981; }
        .progress-blue { background-color: #3b82f6; }
        .progress-purple { background-color: #a855f7; }
        .progress-amber { background-color: #f59e0b; }
        .progress-red { background-color: #ef4444; }
        .progress-pink { background-color: #ec4899; }
        .progress-indigo { background-color: #6366f1; }
        .progress-teal { background-color: #14b8a6; }
        .progress-orange { background-color: #f97316; }
        .progress-cyan { background-color: #06b6d4; }
        .progress-lime { background-color: #84cc16; }
        .progress-rose { background-color: #f43f5e; }
        
        /* Text colors */
        .text-scheme-default { color: white; }
        .text-scheme-default-accent { color: #94a3b8; }
        .text-scheme-emerald { color: white; }
        .text-scheme-emerald-accent { color: #6ee7b7; }
        .text-scheme-blue { color: white; }
        .text-scheme-blue-accent { color: #93c5fd; }
        .text-scheme-purple { color: white; }
        .text-scheme-purple-accent { color: #d8b4fe; }
        .text-scheme-amber { color: #1e293b; }
        .text-scheme-amber-accent { color: #78350f; }
        .text-scheme-red { color: white; }
        .text-scheme-red-accent { color: #fca5a5; }
        .text-scheme-pink { color: white; }
        .text-scheme-pink-accent { color: #f9a8d4; }
        .text-scheme-indigo { color: white; }
        .text-scheme-indigo-accent { color: #a5b4fc; }
        .text-scheme-teal { color: white; }
        .text-scheme-teal-accent { color: #5eead4; }
        .text-scheme-orange { color: #1e293b; }
        .text-scheme-orange-accent { color: #7c2d12; }
        .text-scheme-cyan { color: white; }
        .text-scheme-cyan-accent { color: #67e8f9; }
        .text-scheme-lime { color: #1e293b; }
        .text-scheme-lime-accent { color: #365314; }
        .text-scheme-rose { color: white; }
        .text-scheme-rose-accent { color: #fda4af; }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        const DEFAULT_MILESTONES = [
            { name: 'Super Stack', points: 50, color: 'emerald', id: 1 },
            { name: 'Mega Stack', points: 100, color: 'blue', id: 2 },
            { name: 'Ultra Stack', points: 150, color: 'purple', id: 3 },
            { name: 'Hyper Stack', points: 200, color: 'amber', id: 4 }
        ];

        const DEFAULT_STACK_BUTTONS = [
            { name: 'Stack', points: 1, id: 1 },
            { name: 'Stack X5', points: 5, id: 2 },
            { name: 'Stack X10', points: 10, id: 3 }
        ];

        const COLOR_OPTIONS = [
            { name: 'Emerald', value: 'emerald' },
            { name: 'Blue', value: 'blue' },
            { name: 'Purple', value: 'purple' },
            { name: 'Amber', value: 'amber' },
            { name: 'Red', value: 'red' },
            { name: 'Pink', value: 'pink' },
            { name: 'Indigo', value: 'indigo' },
            { name: 'Teal', value: 'teal' },
            { name: 'Orange', value: 'orange' },
            { name: 'Cyan', value: 'cyan' },
            { name: 'Lime', value: 'lime' },
            { name: 'Rose', value: 'rose' }
        ];

        function getColorClasses(color) {
            const scheme = color || 'default';
            return {
                bg: `bg-scheme-${scheme}`,
                card: `bg-scheme-${scheme}-card`,
                button: `bg-scheme-${scheme}-button`,
                text: `text-scheme-${scheme}`,
                accent: `text-scheme-${scheme}-accent`,
                input: `bg-scheme-${scheme}-input`,
                progressBg: 'bg-slate-700',
                progressFill: `progress-${scheme}`
            };
        }

        class HyperStacksApp {
            constructor() {
                this.state = {
                    currentStacks: 0,
                    tasks: [],
                    history: [],
                    activeTab: 'tracker',
                    showAddTask: false,
                    newTask: { name: '', points: 1 },
                    currentDate: new Date().toDateString(),
                    milestones: [...DEFAULT_MILESTONES],
                    stackButtons: [...DEFAULT_STACK_BUTTONS],
                    showHelp: false,
                    showAddMilestone: false,
                    newMilestone: { name: '', points: 0, color: 'emerald' }
                };

                this.loadData();
                this.render();
            }

            loadData() {
                const savedData = localStorage.getItem('hyperStacksData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    const today = new Date().toDateString();

                    if (data.lastDate !== today && data.currentStacks > 0) {
                        const reachedMilestones = data.milestones.filter(m => data.currentStacks >= m.points).length;
                        this.state.history = [...data.history, {
                            date: data.lastDate,
                            stacks: data.currentStacks,
                            milestones: reachedMilestones
                        }];
                        this.state.currentStacks = 0;
                        this.state.tasks = data.tasks || [];
                        this.state.milestones = data.milestones || [...DEFAULT_MILESTONES];
                        this.state.stackButtons = data.stackButtons || [...DEFAULT_STACK_BUTTONS];
                        this.saveData();
                    } else {
                        this.state.currentStacks = data.currentStacks || 0;
                        this.state.tasks = data.tasks || [];
                        this.state.history = data.history || [];
                        this.state.milestones = data.milestones || [...DEFAULT_MILESTONES];
                        this.state.stackButtons = data.stackButtons || [...DEFAULT_STACK_BUTTONS];
                    }
                }
            }

            saveData() {
                localStorage.setItem('hyperStacksData', JSON.stringify({
                    currentStacks: this.state.currentStacks,
                    tasks: this.state.tasks,
                    history: this.state.history,
                    lastDate: this.state.currentDate,
                    milestones: this.state.milestones,
                    stackButtons: this.state.stackButtons
                }));
            }

            setState(updates) {
                Object.assign(this.state, updates);
                this.saveData();
                this.render();
            }

            addStacks(amount) {
                const maxPoints = this.state.milestones.length > 0 
                    ? Math.max(...this.state.milestones.map(m => m.points)) 
                    : 200;
                this.setState({
                    currentStacks: Math.min(this.state.currentStacks + amount, maxPoints)
                });
            }

            getCurrentMilestone() {
                const sorted = [...this.state.milestones].sort((a, b) => b.points - a.points);
                for (let milestone of sorted) {
                    if (this.state.currentStacks >= milestone.points) {
                        return milestone;
                    }
                }
                return null;
            }

            getNextMilestone() {
                const sorted = [...this.state.milestones].sort((a, b) => a.points - b.points);
                return sorted.find(m => this.state.currentStacks < m.points);
            }

            getProgressColor(milestoneColor) {
                const colors = getColorClasses(milestoneColor);
                return colors.progressFill;
            }

            render() {
                const currentMilestone = this.getCurrentMilestone();
                const colorScheme = getColorClasses(currentMilestone?.color || 'default');
                const app = document.getElementById('app');

                app.innerHTML = `
                    <div class="min-h-screen ${colorScheme.bg} ${colorScheme.text} pb-20">
                        <!-- Help Button -->
                        <button id="helpBtn" class="fixed bottom-6 right-6 ${colorScheme.button} p-4 rounded-full shadow-2xl z-50 transition-transform active:scale-95">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                        </button>

                        <!-- Help Modal -->
                        <div id="helpModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
                            <div class="${colorScheme.card} rounded-2xl p-6 max-w-lg w-full max-h-[80vh] overflow-y-auto">
                                <div class="flex justify-between items-center mb-4">
                                    <h2 class="text-2xl font-bold">How Hyper Stacks Works</h2>
                                    <button id="closeHelp" class="${colorScheme.button} p-2 rounded-full transition-transform active:scale-95">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <line x1="18" y1="6" x2="6" y2="18"></line>
                                            <line x1="6" y1="6" x2="18" y2="18"></line>
                                        </svg>
                                    </button>
                                </div>
                                <div class="space-y-4 text-sm">
                                    <div>
                                        <h3 class="font-semibold mb-2">üìä Tracker Tab</h3>
                                        <p>Tap the Stack buttons to earn points throughout your day. Watch the color scheme change as you reach different milestones! Your progress resets at midnight each day.</p>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold mb-2">‚úÖ Tasks Tab</h3>
                                        <p>Create a list of your daily tasks and assign point values (1, 5, or 10 points) to each. Use this as a reference guide to know how much each completed task is worth.</p>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold mb-2">üìÖ History Tab</h3>
                                        <p>View your past performance with a graph and detailed records showing how many stacks you earned and milestones you reached each day.</p>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold mb-2">‚öôÔ∏è Settings Tab</h3>
                                        <p>Customize your experience! Change stack button names and point values, edit milestone names and requirements, add new milestones with custom colors, or remove milestones you don't need.</p>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold mb-2">üé® Color Schemes</h3>
                                        <p>The app's color scheme automatically changes when you reach each milestone, providing visual feedback on your progress throughout the day.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Header -->
                        <div class="${colorScheme.card} p-6 shadow-lg">
                            <h1 class="text-3xl font-bold text-center mb-2">Hyper Stacks</h1>
                            <p class="text-center ${colorScheme.accent} text-sm">
                                ${new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                            </p>
                        </div>

                        <!-- Tab Navigation -->
                        <div class="flex border-b border-slate-700">
                            <button data-tab="tracker" class="tab-btn flex-1 py-3 px-2 sm:px-4 flex items-center justify-center gap-2 transition-colors ${this.state.activeTab === 'tracker' ? colorScheme.button : 'bg-transparent'}">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                                    <polyline points="17 6 23 6 23 12"></polyline>
                                </svg>
                                <span class="text-sm sm:text-base">Tracker</span>
                            </button>
                            <button data-tab="tasks" class="tab-btn flex-1 py-3 px-2 sm:px-4 flex items-center justify-center gap-2 transition-colors ${this.state.activeTab === 'tasks' ? colorScheme.button : 'bg-transparent'}">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="8" y1="6" x2="21" y2="6"></line>
                                    <line x1="8" y1="12" x2="21" y2="12"></line>
                                    <line x1="8" y1="18" x2="21" y2="18"></line>
                                    <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                    <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                    <line x1="3" y1="18" x2="3.01" y2="18"></line>
                                </svg>
                                <span class="text-sm sm:text-base">Tasks</span>
                            </button>
                            <button data-tab="history" class="tab-btn flex-1 py-3 px-2 sm:px-4 flex items-center justify-center gap-2 transition-colors ${this.state.activeTab === 'history' ? colorScheme.button : 'bg-transparent'}">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                                <span class="text-sm sm:text-base">History</span>
                            </button>
                            <button data-tab="settings" class="tab-btn flex-1 py-3 px-2 sm:px-4 flex items-center justify-center gap-2 transition-colors ${this.state.activeTab === 'settings' ? colorScheme.button : 'bg-transparent'}">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="3"></circle>
                                    <path d="M12 1v6m0 6v6m9-9h-6m-6 0H3"></path>
                                </svg>
                                <span class="text-sm sm:text-base">Settings</span>
                            </button>
                        </div>

                        <!-- Main Content -->
                        <div class="p-4 sm:p-6">
                            ${this.renderContent(colorScheme)}
                        </div>
                    </div>
                `;

                this.attachEventListeners(colorScheme);
            }

            renderContent(colorScheme) {
                switch(this.state.activeTab) {
                    case 'tracker':
                        return this.renderTracker(colorScheme);
                    case 'tasks':
                        return this.renderTasks(colorScheme);
                    case 'history':
                        return this.renderHistory(colorScheme);
                    case 'settings':
                        return this.renderSettings(colorScheme);
                    default:
                        return '';
                }
            }

            renderTracker(colorScheme) {
                const currentMilestone = this.getCurrentMilestone();
                const nextMilestone = this.getNextMilestone();

                return `
                    <div class="space-y-6">
                        <div class="${colorScheme.card} rounded-2xl p-8 text-center shadow-xl">
                            <p class="${colorScheme.accent} text-sm uppercase tracking-wide mb-2">Current Stacks</p>
                            <p class="text-6xl font-bold mb-4">${this.state.currentStacks}</p>
                            ${currentMilestone ? `
                                <div class="mb-2">
                                    <span class="inline-block px-4 py-2 rounded-full ${colorScheme.button} font-semibold">
                                        üèÜ ${currentMilestone.name}
                                    </span>
                                </div>
                            ` : ''}
                            ${nextMilestone ? `
                                <p class="${colorScheme.accent} text-sm">
                                    ${nextMilestone.points - this.state.currentStacks} more to ${nextMilestone.name}
                                </p>
                            ` : this.state.currentStacks > 0 ? `
                                <p class="${colorScheme.accent} text-sm">üéâ Maximum milestone reached!</p>
                            ` : ''}
                        </div>

                        ${this.state.milestones.length > 0 ? `
                            <div class="${colorScheme.card} rounded-2xl p-6 shadow-xl">
                                <h3 class="font-semibold mb-4">Milestone Progress</h3>
                                <div class="space-y-3">
                                    ${[...this.state.milestones].sort((a, b) => a.points - b.points).map(milestone => {
                                        const isReached = this.state.currentStacks >= milestone.points;
                                        const progress = Math.min((this.state.currentStacks / milestone.points) * 100, 100);
                                        return `
                                            <div>
                                                <div class="flex justify-between text-sm mb-1">
                                                    <span>${milestone.name}</span>
                                                    <span>${milestone.points} pts</span>
                                                </div>
                                                <div class="w-full ${colorScheme.progressBg} rounded-full h-2">
                                                    <div class="progress-bar ${isReached ? this.getProgressColor(milestone.color) : colorScheme.progressFill} h-2 rounded-full" style="width: ${progress}%"></div>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        ` : ''}

                        <div class="space-y-3">
                            ${this.state.stackButtons.map(btn => `
                                <button class="stack-btn w-full ${colorScheme.button} py-6 rounded-xl font-bold text-xl shadow-lg transition-transform active:scale-95" data-points="${btn.points}">
                                    ${btn.name} (+${btn.points})
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            renderTasks(colorScheme) {
                return `
                    <div class="space-y-4">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-bold">Task List</h2>
                            <button id="showAddTaskBtn" class="${colorScheme.button} p-3 rounded-full shadow-lg transition-transform active:scale-95">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                            </button>
                        </div>

                        ${this.state.showAddTask ? `
                            <div class="${colorScheme.card} rounded-xl p-4 shadow-xl mb-4">
                                <input type="text" id="taskName" placeholder="Task name..." class="w-full ${colorScheme.input} rounded-lg px-4 py-3 mb-3 outline-none border-0">
                                <div class="flex gap-2 mb-3">
                                    ${[1, 5, 10].map(points => `
                                        <button class="task-points-btn flex-1 py-2 rounded-lg transition-colors ${this.state.newTask.points === points ? colorScheme.button : colorScheme.input}" data-points="${points}">
                                            ${points} pt${points > 1 ? 's' : ''}
                                        </button>
                                    `).join('')}
                                </div>
                                <div class="flex gap-2">
                                    <button id="addTaskBtn" class="flex-1 ${colorScheme.button} py-2 rounded-lg font-semibold transition-transform active:scale-95">Add Task</button>
                                    <button id="cancelTaskBtn" class="px-4 py-2 ${colorScheme.input} rounded-lg transition-transform active:scale-95">Cancel</button>
                                </div>
                            </div>
                        ` : ''}

                        <div class="space-y-2">
                            ${this.state.tasks.length === 0 ? `
                                <p class="text-center ${colorScheme.accent} py-8">No tasks yet. Add your first task!</p>
                            ` : this.state.tasks.map(task => `
                                <div class="${colorScheme.card} rounded-xl p-4 flex justify-between items-center shadow-lg">
                                    <div>
                                        <p class="font-semibold">${task.name}</p>
                                        <p class="text-sm ${colorScheme.accent}">${task.points} point${task.points > 1 ? 's' : ''}</p>
                                    </div>
                                    <button class="delete-task-btn p-2 bg-red-600 hover:bg-red-700 rounded-full transition-all" data-id="${task.id}">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <line x1="18" y1="6" x2="6" y2="18"></line>
                                            <line x1="6" y1="6" x2="18" y2="18"></line>
                                        </svg>
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            renderHistory(colorScheme) {
                const maxHistory = Math.max(
                    ...this.state.history.map(h => h.stacks),
                    this.state.milestones.length > 0 ? Math.max(...this.state.milestones.map(m => m.points)) : 200,
                    1
                );

                return `
                    <div class="space-y-4">
                        <h2 class="text-2xl font-bold mb-4">History</h2>
                        
                        ${this.state.history.length === 0 ? `
                            <p class="text-center ${colorScheme.accent} py-8">No history yet. Complete your first day!</p>
                        ` : `
                            <div class="${colorScheme.card} rounded-xl p-6 shadow-xl mb-6">
                                <h3 class="font-semibold mb-4">Stack History</h3>
                                <div class="flex items-end justify-between h-48 gap-1 sm:gap-2">
                                    ${this.state.history.slice(-7).map(day => {
                                        const height = (day.stacks / maxHistory) * 100;
                                        return `
                                            <div class="flex-1 flex flex-col items-center gap-2">
                                                <div class="w-full flex flex-col justify-end h-full">
                                                    <div class="w-full ${colorScheme.button} rounded-t transition-all" style="height: ${height}%"></div>
                                                </div>
                                                <p class="text-xs text-center">${day.stacks}</p>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>

                            <div class="space-y-2">
                                ${[...this.state.history].reverse().map(day => `
                                    <div class="${colorScheme.card} rounded-xl p-4 shadow-lg">
                                        <div class="flex justify-between items-center">
                                            <div>
                                                <p class="font-semibold">${day.date}</p>
                                                <p class="text-sm ${colorScheme.accent}">
                                                    ${day.stacks} stacks ‚Ä¢ ${day.milestones} milestone${day.milestones !== 1 ? 's' : ''}
                                                </p>
                                            </div>
                                            <div class="text-right">
                                                <p class="text-2xl font-bold">${day.stacks}</p>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>
                `;
            }

            renderSettings(colorScheme) {
                return `
                    <div class="space-y-6">
                        <h2 class="text-2xl font-bold mb-4">Settings</h2>

                        <!-- Stack Buttons Settings -->
                        <div class="${colorScheme.card} rounded-xl p-6 shadow-xl">
                            <h3 class="font-semibold mb-4">Stack Buttons</h3>
                            <div class="space-y-4">
                                ${this.state.stackButtons.map(btn => `
                                    <div class="space-y-2">
                                        <label class="text-sm font-medium">Button ${btn.id} Name</label>
                                        <input type="text" class="btn-name-input w-full ${colorScheme.input} rounded-lg px-4 py-2 outline-none border-0" data-id="${btn.id}" value="${btn.name}">
                                        <label class="text-sm font-medium">Point Value</label>
                                        <input type="number" class="btn-points-input w-full ${colorScheme.input} rounded-lg px-4 py-2 outline-none border-0" data-id="${btn.id}" value="${btn.points}" min="1">
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- Milestones Settings -->
                        <div class="${colorScheme.card} rounded-xl p-6 shadow-xl">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="font-semibold">Milestones</h3>
                                <button id="showAddMilestoneBtn" class="${colorScheme.button} p-2 rounded-full transition-transform active:scale-95">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="12" y1="5" x2="12" y2="19"></line>
                                        <line x1="5" y1="12" x2="19" y2="12"></line>
                                    </svg>
                                </button>
                            </div>

                            ${this.state.showAddMilestone ? `
                                <div class="mb-4 p-4 border-2 border-dashed border-slate-600 rounded-lg space-y-3">
                                    <input type="text" id="newMilestoneName" placeholder="Milestone name..." class="w-full ${colorScheme.input} rounded-lg px-4 py-2 outline-none border-0" value="${this.state.newMilestone.name}">
                                    <input type="number" id="newMilestonePoints" placeholder="Points required..." class="w-full ${colorScheme.input} rounded-lg px-4 py-2 outline-none border-0" value="${this.state.newMilestone.points || ''}" min="1">
                                    <select id="newMilestoneColor" class="w-full ${colorScheme.input} rounded-lg px-4 py-2 outline-none border-0">
                                        ${COLOR_OPTIONS.map(color => `
                                            <option value="${color.value}" ${this.state.newMilestone.color === color.value ? 'selected' : ''}>${color.name}</option>
                                        `).join('')}
                                    </select>
                                    <div class="flex gap-2">
                                        <button id="addMilestoneBtn" class="flex-1 ${colorScheme.button} py-2 rounded-lg font-semibold transition-transform active:scale-95">Add Milestone</button>
                                        <button id="cancelMilestoneBtn" class="px-4 py-2 ${colorScheme.input} rounded-lg transition-transform active:scale-95">Cancel</button>
                                    </div>
                                </div>
                            ` : ''}

                            <div class="space-y-4">
                                ${[...this.state.milestones].sort((a, b) => a.points - b.points).map(milestone => `
                                    <div class="p-4 ${colorScheme.input} rounded-lg space-y-2">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="font-semibold">Milestone</span>
                                            <button class="delete-milestone-btn p-1 bg-red-600 hover:bg-red-700 rounded transition-all" data-id="${milestone.id}">
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                                </svg>
                                            </button>
                                        </div>
                                        <input type="text" class="milestone-name-input w-full ${colorScheme.input} rounded px-3 py-2 outline-none border border-slate-600" data-id="${milestone.id}" value="${milestone.name}" placeholder="Milestone name">
                                        <input type="number" class="milestone-points-input w-full ${colorScheme.input} rounded px-3 py-2 outline-none border border-slate-600" data-id="${milestone.id}" value="${milestone.points}" placeholder="Points required" min="1">
                                        <select class="milestone-color-input w-full ${colorScheme.input} rounded px-3 py-2 outline-none border border-slate-600" data-id="${milestone.id}">
                                            ${COLOR_OPTIONS.map(color => `
                                                <option value="${color.value}" ${milestone.color === color.value ? 'selected' : ''}>${color.name}</option>
                                            `).join('')}
                                        </select>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }

            attachEventListeners(colorScheme) {
                // Help modal
                document.getElementById('helpBtn')?.addEventListener('click', () => {
                    document.getElementById('helpModal').classList.remove('hidden');
                });
                document.getElementById('closeHelp')?.addEventListener('click', () => {
                    document.getElementById('helpModal').classList.add('hidden');
                });

                // Tab navigation
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.setState({ activeTab: e.currentTarget.dataset.tab });
                    });
                });

                // Stack buttons
                document.querySelectorAll('.stack-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.addStacks(parseInt(e.currentTarget.dataset.points));
                    });
                });

                // Tasks
                document.getElementById('showAddTaskBtn')?.addEventListener('click', () => {
                    this.setState({ showAddTask: true });
                });

                document.getElementById('cancelTaskBtn')?.addEventListener('click', () => {
                    this.setState({ showAddTask: false, newTask: { name: '', points: 1 } });
                });

                document.querySelectorAll('.task-points-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.state.newTask.points = parseInt(e.currentTarget.dataset.points);
                        this.render();
                    });
                });

                document.getElementById('addTaskBtn')?.addEventListener('click', () => {
                    const name = document.getElementById('taskName').value;
                    if (name.trim()) {
                        this.setState({
                            tasks: [...this.state.tasks, { 
                                name, 
                                points: this.state.newTask.points, 
                                id: Date.now() 
                            }],
                            showAddTask: false,
                            newTask: { name: '', points: 1 }
                        });
                    }
                });

                document.querySelectorAll('.delete-task-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.dataset.id);
                        this.setState({
                            tasks: this.state.tasks.filter(t => t.id !== id)
                        });
                    });
                });

                // Settings - Stack Buttons
                document.querySelectorAll('.btn-name-input').forEach(input => {
                    input.addEventListener('change', (e) => {
                        const id = parseInt(e.target.dataset.id);
                        this.setState({
                            stackButtons: this.state.stackButtons.map(btn =>
                                btn.id === id ? { ...btn, name: e.target.value } : btn
                            )
                        });
                    });
                });

                document.querySelectorAll('.btn-points-input').forEach(input => {
                    input.addEventListener('change', (e) => {
                        const id = parseInt(e.target.dataset.id);
                        this.setState({
                            stackButtons: this.state.stackButtons.map(btn =>
                                btn.id === id ? { ...btn, points: parseInt(e.target.value) || 1 } : btn
                            )
                        });
                    });
                });

                // Settings - Milestones
                document.getElementById('showAddMilestoneBtn')?.addEventListener('click', () => {
                    this.setState({ showAddMilestone: true });
                });

                document.getElementById('cancelMilestoneBtn')?.addEventListener('click', () => {
                    this.setState({ 
                        showAddMilestone: false, 
                        newMilestone: { name: '', points: 0, color: 'emerald' } 
                    });
                });

                document.getElementById('newMilestoneName')?.addEventListener('input', (e) => {
                    this.state.newMilestone.name = e.target.value;
                });

                document.getElementById('newMilestonePoints')?.addEventListener('input', (e) => {
                    this.state.newMilestone.points = parseInt(e.target.value) || 0;
                });

                document.getElementById('newMilestoneColor')?.addEventListener('change', (e) => {
                    this.state.newMilestone.color = e.target.value;
                });

                document.getElementById('addMilestoneBtn')?.addEventListener('click', () => {
                    if (this.state.newMilestone.name.trim() && this.state.newMilestone.points > 0) {
                        this.setState({
                            milestones: [...this.state.milestones, {
                                ...this.state.newMilestone,
                                id: Date.now()
                            }].sort((a, b) => a.points - b.points),
                            showAddMilestone: false,
                            newMilestone: { name: '', points: 0, color: 'emerald' }
                        });
                    }
                });

                document.querySelectorAll('.milestone-name-input').forEach(input => {
                    input.addEventListener('change', (e) => {
                        const id = parseInt(e.target.dataset.id);
                        this.setState({
                            milestones: this.state.milestones.map(m =>
                                m.id === id ? { ...m, name: e.target.value } : m
                            )
                        });
                    });
                });

                document.querySelectorAll('.milestone-points-input').forEach(input => {
                    input.addEventListener('change', (e) => {
                        const id = parseInt(e.target.dataset.id);
                        this.setState({
                            milestones: this.state.milestones.map(m =>
                                m.id === id ? { ...m, points: parseInt(e.target.value) || 1 } : m
                            )
                        });
                    });
                });

                document.querySelectorAll('.milestone-color-input').forEach(input => {
                    input.addEventListener('change', (e) => {
                        const id = parseInt(e.target.dataset.id);
                        this.setState({
                            milestones: this.state.milestones.map(m =>
                                m.id === id ? { ...m, color: e.target.value } : m
                            )
                        });
                    });
                });

                document.querySelectorAll('.delete-milestone-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.dataset.id);
                        this.setState({
                            milestones: this.state.milestones.filter(m => m.id !== id)
                        });
                    });
                });
            }
        }

        // Initialize app
        new HyperStacksApp();
    </script>
</body>
</html>
